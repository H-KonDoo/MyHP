<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ポートフォリオ編集ツール</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #333;
            border-bottom: 2px solid #FFA500;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        .intro-text {
            text-align: center;
            margin-bottom: 30px;
            font-size: 0.95rem;
            color: #666;
        }

        .editor-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus,
        textarea:focus {
            border-color: #FFA500;
            outline: none;
        }

        textarea {
            height: 180px;
            resize: vertical;
        }

        .file-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .file-input-group input[type="text"] {
            flex: 1;
        }

        button.action-btn {
            background-color: #FFA500;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 30px;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 2px 5px rgba(255, 165, 0, 0.3);
        }

        button.action-btn:hover {
            background-color: #ff8c00;
        }

        button.action-btn:active {
            transform: translateY(1px);
        }

        .output-section {
            margin-top: 40px;
            border-top: 2px dashed #ddd;
            padding-top: 30px;
            display: none;
        }

        .output-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .output-box {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: Consolas, Monaco, monospace;
            font-size: 14px;
            margin-bottom: 15px;
            overflow-x: auto;
        }

        .copy-btn {
            background-color: #555;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .copy-btn:hover {
            background-color: #333;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 0;
            padding-left: 10px;
        }

        .tab {
            padding: 12px 25px;
            cursor: pointer;
            background: #e0e0e0;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            color: #666;
            transition: background 0.2s;
        }

        .tab.active {
            background: #FFA500;
            color: white;
        }

        .tab:hover:not(.active) {
            background: #d0d0d0;
        }

        .instruction-box {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .step-badge {
            display: inline-block;
            background: #2e7d32;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
            font-size: 14px;
            margin-right: 8px;
        }

        .note {
            font-size: 0.85rem;
            color: #888;
            margin-top: 5px;
        }
    </style>
</head>

<body>

    <h1>KonDo.FILE 管理ツール</h1>
    <p class="intro-text">
        このツールで内容を編集し、最後に「保存用データを作成」ボタンを押してください。<br>
        作成されたデータで <code>data.js</code> を上書き保存すると、ホームページ全体が更新されます。<br>
        <span style="color:#d32f2f; font-weight:bold;">※ 画像ファイルを使用する場合は、必ずこのツールや <code>index.html</code>
            と同じフォルダに画像ファイルを置いてください。</span>
    </p>

    <!-- タブ切り替え -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab('profile')">1. 経歴 (プロフィール)</div>
        <div class="tab" onclick="switchTab('games')">2. ゲームリスト</div>
        <div class="tab" onclick="switchTab('creations')">3. 創作物リスト</div>
        <div class="tab" onclick="switchTab('schedule')">4. メモ</div>
        <div class="tab" onclick="switchTab('terms')">5. 規約</div>
        <div class="tab" onclick="switchTab('secrets')">6. 私的なこと</div>
        <div class="tab" style="background:#4CAF50; color:white;" onclick="generateDataFile()">★ 保存用データ作成</div>
    </div>

    <div class="editor-container">

        <!-- ==============================================
             1. プロフィール編集
             ============================================== -->
        <div id="view-profile">
            <h3>プロフィール編集</h3>
            <div class="form-group" style="background:#fff3e0; padding:10px; border-radius:6px; margin-bottom:20px;">
                <label>バージョン番号 (画面右下に表示)</label>
                <input type="text" id="prof-version" placeholder="1.0" style="width:100px;">
            </div>

            <div class="form-group">
                <label>名前</label>
                <input type="text" id="prof-name">
            </div>
            <div class="form-group">
                <label>自己紹介文</label>
                <textarea id="prof-bio"></textarea>
            </div>
        </div>

        <!-- ==============================================
             2. ゲームリスト編集
             ============================================== -->
        <div id="view-games" style="display:none;">
            <h3>ゲームリスト編集</h3>
            <div id="games-container"></div>
            <button class="action-btn" style="background:#666; margin-top:20px;" onclick="addGame()">＋ ゲームを追加する</button>
        </div>

        <!-- ==============================================
             3. 創作物リスト編集
             ============================================== -->
        <div id="view-creations" style="display:none;">
            <h3>創作物リスト編集</h3>
            <div id="creations-container"></div>
            <button class="action-btn" style="background:#666; margin-top:20px;" onclick="addCreation()">＋
                創作物を追加する</button>
        </div>

        <!-- ==============================================
             4. メモ編集
             ============================================== -->
        <div id="view-schedule" style="display:none;">
            <h3>メモ編集</h3>
            <div id="schedule-container"></div>
            <button class="action-btn" style="background:#666; margin-top:20px;" onclick="addSchedule()">＋
                メモを追加する</button>
        </div>

        <!-- ==============================================
             5. 規約リスト編集
             ============================================== -->
        <div id="view-terms" style="display:none;">
            <h3>規約リスト編集</h3>
            <div id="terms-container"></div>
            <button class="action-btn" style="background:#666; margin-top:20px;" onclick="addTerm()">＋
                規約を追加する</button>
        </div>

        <!-- ==============================================
             5. 私的なことリスト編集
             ============================================== -->
        <div id="view-secrets" style="display:none;">
            <h3>私的なことリスト編集</h3>
            <div id="secrets-container"></div>
            <button class="action-btn" style="background:#666; margin-top:20px;" onclick="addSecret()">＋
                私的なことを追加する</button>
        </div>

        <!-- ==============================================
             6. データ出力 (保存)
             ============================================== -->
        <div id="view-output" style="display:none;">
            <div class="instruction-box">
                <span class="step-badge">重要</span> <b>更新手順</b><br>
                1. 下の「コードをコピーする」ボタンを押します。<br>
                2. <b><code>data.js</code></b> ファイルをメモ帳などで開きます。<br>
                3. 中身をすべて消して、貼り付け（上書き）て保存してください。<br>
                4. <code>index.html</code> を開くと更新されています。
            </div>

            <div class="output-title">
                保存用データ (data.js)
                <button class="copy-btn" onclick="copyToClipboard()">コードをコピーする</button>
            </div>
            <div id="output-box" class="output-box"></div>
        </div>

    </div>

    <!-- 既存データの読み込み -->
    <script src="data.js"></script>
    <script>
        // 作業用変数
        let currentData = {
            version: "1.0",
            profile: { name: "", bio: "" },
            games: [],
            creations: [],
            terms: [],
            secrets: [],
            schedule: []
        };

        // ページ読み込み時に data.js の内容をフォームにセット
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof portfolioData !== 'undefined') {
                // ディープコピーで読み込み
                currentData = JSON.parse(JSON.stringify(portfolioData));
                // 既存データにversionがない場合のフォールバック
                if (!currentData.version) currentData.version = "1.0";
                if (!currentData.creations) currentData.creations = [];
                // 既存データにtermsがない場合のフォールバック
                if (!currentData.terms) currentData.terms = [];
                // 既存データにsecretsがない場合のフォールバック
                if (!currentData.secrets) currentData.secrets = [];

                initForms();
            } else {
                alert("data.js が見つかりませんでした。新規作成モードで開始します。");
            }
        });

        function initForms() {
            // バージョン
            const savedVer = currentData.version || "1.0";
            document.getElementById('prof-version').value = savedVer;

            // プロフィール
            document.getElementById('prof-name').value = currentData.profile.name;
            document.getElementById('prof-bio').value = currentData.profile.bio.replace(/<br>/g, "\n");

            // ゲーム
            renderGamesList();

            // 創作物
            renderCreationsList();

            // メモ
            renderScheduleList();

            // 規約
            renderTermsList();

            // 私的なこと
            renderSecretsList();
        }

        function switchTab(mode) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            saveCurrentInputsToMemory();

            document.getElementById('view-profile').style.display = 'none';
            document.getElementById('view-games').style.display = 'none';
            document.getElementById('view-creations').style.display = 'none';
            document.getElementById('view-schedule').style.display = 'none';
            document.getElementById('view-creations').style.display = 'none';
            document.getElementById('view-schedule').style.display = 'none';
            document.getElementById('view-terms').style.display = 'none';
            document.getElementById('view-secrets').style.display = 'none';
            document.getElementById('view-output').style.display = 'none';

            if (mode === 'profile') {
                document.getElementById('view-profile').style.display = 'block';
                event.target.classList.add('active');
            }
            if (mode === 'games') {
                document.getElementById('view-games').style.display = 'block';
                event.target.classList.add('active');
            }
            if (mode === 'creations') {
                document.getElementById('view-creations').style.display = 'block';
                event.target.classList.add('active');
            }
            if (mode === 'schedule') {
                document.getElementById('view-schedule').style.display = 'block';
                event.target.classList.add('active');
            }
            if (mode === 'terms') {
                document.getElementById('view-terms').style.display = 'block';
                event.target.classList.add('active');
            }
            if (mode === 'secrets') {
                document.getElementById('view-secrets').style.display = 'block';
                event.target.classList.add('active');
            }
        }

        function saveCurrentInputsToMemory() {
            // Profile & Version
            if (document.getElementById('prof-version')) {
                currentData.version = document.getElementById('prof-version').value;
            }
            if (document.getElementById('prof-name')) {
                currentData.profile.name = document.getElementById('prof-name').value;
                currentData.profile.bio = document.getElementById('prof-bio').value.replace(/\n/g, "<br>");
            }
            // Games, Creations, Secrets, Schedule are updated live via inputs, no global save needed for lists specifically
            // because input onchange events handle them.
        }

        // ================= GAMES =================
        function renderGamesList() {
            const container = document.getElementById('games-container');
            container.innerHTML = "";
            currentData.games.forEach((game, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.border = "1px solid #ddd";
                div.style.padding = "15px";
                div.style.marginBottom = "20px";

                // Header with Delete Button
                const headerDiv = document.createElement('div');
                headerDiv.style.display = "flex";
                headerDiv.style.justifyContent = "space-between";
                headerDiv.style.marginBottom = "10px";

                const titleStrong = document.createElement('strong');
                titleStrong.innerText = `ゲーム #${index + 1} (ID: ${game.id})`;

                const deleteBtn = document.createElement('button');
                deleteBtn.type = "button";
                deleteBtn.innerText = "削除";
                deleteBtn.style.background = "#d32f2f";
                deleteBtn.style.color = "white";
                deleteBtn.style.border = "none";
                deleteBtn.style.padding = "5px 10px";
                deleteBtn.style.borderRadius = "4px";
                deleteBtn.style.cursor = "pointer";

                // Attach event listener for delete button
                deleteBtn.addEventListener('click', function () {
                    removeGame(index);
                });

                headerDiv.appendChild(titleStrong);
                headerDiv.appendChild(deleteBtn);
                div.appendChild(headerDiv);

                // Inputs (using template literal for brevity, but could also be DOM elements)
                // Note: We use a wrapper for the rest to keep it simple
                const contentDiv = document.createElement('div');
                contentDiv.innerHTML = `
                    <label>タイトル</label>
                    <input type="text" value="${escapeAttr(game.title)}" onchange="updateGame(${index}, 'title', this.value)">
                    
                    <label style="margin-top:10px;">ID (英数字推奨)</label>
                    <input type="text" value="${escapeAttr(game.id)}" onchange="updateGame(${index}, 'id', this.value)">

                    <label style="margin-top:10px;">画像ファイル名</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="text" id="game-image-${index}" value="${escapeAttr(game.image)}" onchange="updateGame(${index}, 'image', this.value)" style="flex:1;">
                        <input type="file" accept="image/*" onchange="pickGameImage(${index}, this)" style="width:auto;">
                    </div>
                    <div id="game-preview-${index}" style="margin-top:10px;">
                        ${game.image ? `<img src="${escapeAttr(game.image)}" alt="preview" style="max-height:100px; max-width:200px; border:1px solid #ddd; padding:2px;">` : ''}
                    </div>
                    
                    <label style="margin-top:10px;">紹介文</label>
                    <textarea onchange="updateGame(${index}, 'description', this.value)" style="height:100px;">${game.description}</textarea>
                `;
                div.appendChild(contentDiv);

                container.appendChild(div);
            });
        }

        function addGame() {
            const newId = "game" + (new Date().getTime());
            currentData.games.unshift({
                id: newId,
                title: "新規ゲーム",
                image: "",
                description: "紹介文を入力"
            });
            renderGamesList();
        }

        function removeGame(index) {
            console.log("Attempting to remove game at index:", index);
            if (confirm("このゲームを削除してもよろしいですか？")) {
                try {
                    currentData.games.splice(index, 1);
                    renderGamesList();
                    console.log("Game removed successfully");
                } catch (e) {
                    console.error("Error removing game:", e);
                    alert("削除中にエラーが発生しました。");
                }
            }
        }

        function updateGame(index, field, value) {
            currentData.games[index][field] = value;
        }

        function pickGameImage(index, input) {
            if (input.files && input.files.length > 0) {
                const fileName = input.files[0].name;
                // Update data
                updateGame(index, 'image', fileName);
                // Update text input view
                if (textInput) textInput.value = fileName;

                // プレビュー表示
                const previewDiv = document.getElementById(`game-preview-${index}`);
                if (previewDiv) {
                    const file = input.files[0];
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewDiv.innerHTML = `<img src="${e.target.result}" alt="preview" style="max-height:100px; max-width:200px; border:1px solid #ddd; padding:2px;">`;
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        // ================= CREATIONS =================
        function renderCreationsList() {
            const container = document.getElementById('creations-container');
            container.innerHTML = "";
            currentData.creations.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.border = "1px solid #ddd";
                div.style.padding = "15px";
                div.style.marginBottom = "20px";

                // Header with Delete Button
                const headerDiv = document.createElement('div');
                headerDiv.style.display = "flex";
                headerDiv.style.justifyContent = "space-between";
                headerDiv.style.marginBottom = "10px";

                const titleStrong = document.createElement('strong');
                titleStrong.innerText = `創作物 #${index + 1} (ID: ${item.id})`;

                const deleteBtn = document.createElement('button');
                deleteBtn.type = "button";
                deleteBtn.innerText = "削除";
                deleteBtn.style.background = "#d32f2f";
                deleteBtn.style.color = "white";
                deleteBtn.style.border = "none";
                deleteBtn.style.padding = "5px 10px";
                deleteBtn.style.borderRadius = "4px";
                deleteBtn.style.cursor = "pointer";

                deleteBtn.addEventListener('click', function () {
                    removeCreation(index);
                });

                headerDiv.appendChild(titleStrong);
                headerDiv.appendChild(deleteBtn);
                div.appendChild(headerDiv);

                const contentDiv = document.createElement('div');
                contentDiv.innerHTML = `
                    <label>タイトル</label>
                    <input type="text" value="${escapeAttr(item.title)}" onchange="updateCreation(${index}, 'title', this.value)">
                    
                    <label style="margin-top:10px;">ID (英数字推奨)</label>
                    <input type="text" value="${escapeAttr(item.id)}" onchange="updateCreation(${index}, 'id', this.value)">

                    <label style="margin-top:10px;">画像ファイル名</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="text" id="creation-image-${index}" value="${escapeAttr(item.image)}" onchange="updateCreation(${index}, 'image', this.value)" style="flex:1;">
                        <input type="file" accept="image/*" onchange="pickCreationImage(${index}, this)" style="width:auto;">
                    </div>
                    <div id="creation-preview-${index}" style="margin-top:10px;">
                        ${item.image ? `<img src="${escapeAttr(item.image)}" alt="preview" style="max-height:100px; max-width:200px; border:1px solid #ddd; padding:2px;">` : ''}
                    </div>
                    
                    <label style="margin-top:10px;">紹介文</label>
                    <textarea onchange="updateCreation(${index}, 'description', this.value)" style="height:100px;">${item.description}</textarea>
                `;
                div.appendChild(contentDiv);
                container.appendChild(div);
            });
        }

        function addCreation() {
            const newId = "creation" + (new Date().getTime());
            currentData.creations.unshift({
                id: newId,
                title: "新規創作物",
                image: "",
                description: "紹介文を入力"
            });
            renderCreationsList();
        }

        function removeCreation(index) {
            console.log("Attempting to remove creation at index:", index);
            if (confirm("この創作物を削除してもよろしいですか？")) {
                try {
                    currentData.creations.splice(index, 1);
                    renderCreationsList();
                    console.log("Creation removed successfully");
                } catch (e) {
                    console.error(e);
                    alert("エラーが発生しました。");
                }
            }
        }

        function updateCreation(index, field, value) {
            currentData.creations[index][field] = value;
        }

        function pickCreationImage(index, input) {
            if (input.files && input.files.length > 0) {
                const fileName = input.files[0].name;
                updateCreation(index, 'image', fileName);
                if (textInput) textInput.value = fileName;

                // プレビュー表示
                const previewDiv = document.getElementById(`creation-preview-${index}`);
                if (previewDiv) {
                    const file = input.files[0];
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewDiv.innerHTML = `<img src="${e.target.result}" alt="preview" style="max-height:100px; max-width:200px; border:1px solid #ddd; padding:2px;">`;
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        // ================= TERMS =================
        function renderTermsList() {
            const container = document.getElementById('terms-container');
            container.innerHTML = "";
            currentData.terms.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.border = "1px solid #ddd";
                div.style.padding = "15px";
                div.style.marginBottom = "20px";

                const headerDiv = document.createElement('div');
                headerDiv.style.display = "flex";
                headerDiv.style.justifyContent = "space-between";
                headerDiv.style.marginBottom = "10px";

                const titleStrong = document.createElement('strong');
                titleStrong.innerText = `規約 #${index + 1} (ID: ${item.id})`;

                const deleteBtn = document.createElement('button');
                deleteBtn.type = "button";
                deleteBtn.innerText = "削除";
                deleteBtn.style.background = "#d32f2f";
                deleteBtn.style.color = "white";
                deleteBtn.style.border = "none";
                deleteBtn.style.padding = "5px 10px";
                deleteBtn.style.borderRadius = "4px";
                deleteBtn.style.cursor = "pointer";

                deleteBtn.addEventListener('click', function () {
                    removeTerm(index);
                });

                headerDiv.appendChild(titleStrong);
                headerDiv.appendChild(deleteBtn);
                div.appendChild(headerDiv);

                const contentDiv = document.createElement('div');
                contentDiv.innerHTML = `
                    <label>タイトル</label>
                    <input type="text" value="${escapeAttr(item.title)}" onchange="updateTerm(${index}, 'title', this.value)">
                    
                    <label style="margin-top:10px;">ID (英数字推奨)</label>
                    <input type="text" value="${escapeAttr(item.id)}" onchange="updateTerm(${index}, 'id', this.value)">

                    <label style="margin-top:10px;">画像ファイル名 (任意)</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="text" id="term-image-${index}" value="${escapeAttr(item.image)}" onchange="updateTerm(${index}, 'image', this.value)" style="flex:1;">
                        <input type="file" accept="image/*" onchange="pickTermImage(${index}, this)" style="width:auto;">
                    </div>
                    <div id="term-preview-${index}" style="margin-top:10px;">
                        ${item.image ? `<img src="${escapeAttr(item.image)}" alt="preview" style="max-height:100px; max-width:200px; border:1px solid #ddd; padding:2px;">` : ''}
                    </div>
                    
                    <label style="margin-top:10px;">規約本文</label>
                    <textarea onchange="updateTerm(${index}, 'description', this.value)" style="height:100px;">${item.description}</textarea>
                `;
                div.appendChild(contentDiv);
                container.appendChild(div);
            });
        }

        function addTerm() {
            const newId = "term" + (new Date().getTime());
            currentData.terms.unshift({
                id: newId,
                title: "新規規約",
                image: "",
                description: "規約文を入力"
            });
            renderTermsList();
        }

        function removeTerm(index) {
            if (confirm("この規約を削除してもよろしいですか？")) {
                currentData.terms.splice(index, 1);
                renderTermsList();
            }
        }

        function updateTerm(index, field, value) {
            currentData.terms[index][field] = value;
        }

        function pickTermImage(index, input) {
            if (input.files && input.files.length > 0) {
                const fileName = input.files[0].name;
                updateTerm(index, 'image', fileName);
                const textInput = document.getElementById(`term-image-${index}`);
                if (textInput) textInput.value = fileName;

                // プレビュー表示
                const previewDiv = document.getElementById(`term-preview-${index}`);
                if (previewDiv) {
                    const file = input.files[0];
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewDiv.innerHTML = `<img src="${e.target.result}" alt="preview" style="max-height:100px; max-width:200px; border:1px solid #ddd; padding:2px;">`;
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        // ================= SECRETS =================
        function renderSecretsList() {
            const container = document.getElementById('secrets-container');
            container.innerHTML = "";
            currentData.secrets.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.border = "1px solid #ddd";
                div.style.padding = "15px";
                div.style.marginBottom = "20px";

                // Header with Delete Button
                const headerDiv = document.createElement('div');
                headerDiv.style.display = "flex";
                headerDiv.style.justifyContent = "space-between";
                headerDiv.style.marginBottom = "10px";

                const titleStrong = document.createElement('strong');
                titleStrong.innerText = `私的なこと #${index + 1} (ID: ${item.id})`;

                const deleteBtn = document.createElement('button');
                deleteBtn.type = "button";
                deleteBtn.innerText = "削除";
                deleteBtn.style.background = "#d32f2f";
                deleteBtn.style.color = "white";
                deleteBtn.style.border = "none";
                deleteBtn.style.padding = "5px 10px";
                deleteBtn.style.borderRadius = "4px";
                deleteBtn.style.cursor = "pointer";

                deleteBtn.addEventListener('click', function () {
                    removeSecret(index);
                });

                headerDiv.appendChild(titleStrong);
                headerDiv.appendChild(deleteBtn);
                div.appendChild(headerDiv);

                const contentDiv = document.createElement('div');
                contentDiv.innerHTML = `
                    <label>タイトル</label>
                    <input type="text" value="${escapeAttr(item.title)}" onchange="updateSecret(${index}, 'title', this.value)">
                    
                    <label style="margin-top:10px;">ID (英数字推奨)</label>
                    <input type="text" value="${escapeAttr(item.id)}" onchange="updateSecret(${index}, 'id', this.value)">

                    <label style="margin-top:10px;">画像ファイル名</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="text" id="secret-image-${index}" value="${escapeAttr(item.image)}" onchange="updateSecret(${index}, 'image', this.value)" style="flex:1;">
                        <input type="file" accept="image/*" onchange="pickSecretImage(${index}, this)" style="width:auto;">
                    </div>
                    <div id="secret-preview-${index}" style="margin-top:10px;">
                        ${item.image ? `<img src="${escapeAttr(item.image)}" alt="preview" style="max-height:100px; max-width:200px; border:1px solid #ddd; padding:2px;">` : ''}
                    </div>
                    
                    <label style="margin-top:10px;">紹介文</label>
                    <textarea onchange="updateSecret(${index}, 'description', this.value)" style="height:100px;">${item.description}</textarea>
                `;
                div.appendChild(contentDiv);
                container.appendChild(div);
            });
        }

        function addSecret() {
            const newId = "secret" + (new Date().getTime());
            currentData.secrets.unshift({
                id: newId,
                title: "新規の私的なこと",
                image: "",
                description: "内容を入力"
            });
            renderSecretsList();
        }

        function removeSecret(index) {
            if (confirm("この項目を削除してもよろしいですか？")) {
                currentData.secrets.splice(index, 1);
                renderSecretsList();
            }
        }

        function updateSecret(index, field, value) {
            currentData.secrets[index][field] = value;
        }

        function pickSecretImage(index, input) {
            if (input.files && input.files.length > 0) {
                const fileName = input.files[0].name;
                updateSecret(index, 'image', fileName);
                const textInput = document.getElementById(`secret-image-${index}`);
                if (textInput) textInput.value = fileName;

                // プレビュー表示
                const previewDiv = document.getElementById(`secret-preview-${index}`);
                if (previewDiv) {
                    const file = input.files[0];
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewDiv.innerHTML = `<img src="${e.target.result}" alt="preview" style="max-height:100px; max-width:200px; border:1px solid #ddd; padding:2px;">`;
                    };
                    reader.readAsDataURL(file);
                }
            }
        }


        // ================= SCHEDULE =================
        function renderScheduleList() {
            const container = document.getElementById('schedule-container');
            container.innerHTML = "";
            currentData.schedule.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.borderBottom = "1px solid #eee";
                div.style.paddingBottom = "15px";
                div.innerHTML = `
                    <div style="display:flex; gap:10px;">
                        <input type="text" placeholder="日付" value="${escapeAttr(item.date)}" style="width:150px;" onchange="updateSchedule(${index}, 'date', this.value)">
                        <input type="text" placeholder="イベント内容" value="${escapeAttr(item.event)}" style="flex:1;" onchange="updateSchedule(${index}, 'event', this.value)">
                        <button onclick="removeSchedule(${index})" style="background:#ccc; border:none; width:40px; cursor:pointer;">×</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function addSchedule() {
            currentData.schedule.unshift({ date: "", event: "" });
            renderScheduleList();
        }

        function removeSchedule(index) {
            currentData.schedule.splice(index, 1);
            renderScheduleList();
        }

        function updateSchedule(index, field, value) {
            currentData.schedule[index][field] = value;
        }


        // ================= GENERATE =================
        function generateDataFile() {
            saveCurrentInputsToMemory();

            const jsonStr = JSON.stringify(currentData, null, 4);
            // JSファイル形式にする
            const fileContent = `/* ============================================================
   ホームページのデータファイル
   ============================================================ */

const portfolioData = ${jsonStr};
`;

            document.getElementById('view-profile').style.display = 'none';
            document.getElementById('view-games').style.display = 'none';
            document.getElementById('view-creations').style.display = 'none';
            document.getElementById('view-schedule').style.display = 'none';
            document.getElementById('view-terms').style.display = 'none';
            document.getElementById('view-secrets').style.display = 'none';
            document.getElementById('view-output').style.display = 'block'; // Show output

            document.getElementById('output-box').innerText = fileContent;

            // Scroll to output
            document.getElementById('view-output').scrollIntoView();
        }

        function escapeAttr(text) {
            if (!text) return "";
            return text.replace(/"/g, "&quot;");
        }

        function copyToClipboard() {
            const text = document.getElementById('output-box').innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('コピーしました！ data.js に上書き保存してください。');
            });
        }
    </script>
</body>

</html>
```