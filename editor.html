<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ポートフォリオ編集ツール</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #333;
            border-bottom: 2px solid #FFA500;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        .intro-text {
            text-align: center;
            margin-bottom: 30px;
            font-size: 0.95rem;
            color: #666;
        }

        .editor-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus,
        textarea:focus {
            border-color: #FFA500;
            outline: none;
        }

        textarea {
            height: 180px;
            resize: vertical;
        }

        .file-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .file-input-group input[type="text"] {
            flex: 1;
        }

        button.action-btn {
            background-color: #FFA500;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 30px;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 2px 5px rgba(255, 165, 0, 0.3);
        }

        button.action-btn:hover {
            background-color: #ff8c00;
        }

        button.action-btn:active {
            transform: translateY(1px);
        }

        .output-section {
            margin-top: 40px;
            border-top: 2px dashed #ddd;
            padding-top: 30px;
            display: none;
        }

        .output-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .output-box {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: Consolas, Monaco, monospace;
            font-size: 14px;
            margin-bottom: 15px;
            overflow-x: auto;
        }

        .copy-btn {
            background-color: #555;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .copy-btn:hover {
            background-color: #333;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 0;
            padding-left: 10px;
        }

        .tab {
            padding: 12px 25px;
            cursor: pointer;
            background: #e0e0e0;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            color: #666;
            transition: background 0.2s;
        }

        .tab.active {
            background: #FFA500;
            color: white;
        }

        .tab:hover:not(.active) {
            background: #d0d0d0;
        }

        .instruction-box {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .step-badge {
            display: inline-block;
            background: #2e7d32;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
            font-size: 14px;
            margin-right: 8px;
        }

        .note {
            font-size: 0.85rem;
            color: #888;
            margin-top: 5px;
        }
    </style>
</head>

<body>

    <h1>KonDo 紹介ページ 管理ツール</h1>
    <p class="intro-text">
        このツールで内容を編集し、最後に「保存用データを作成」ボタンを押してください。<br>
        作成されたデータで <code>data.js</code> を上書き保存すると、ホームページ全体が更新されます。
    </p>

    <!-- タブ切り替え -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab('profile')">1. 経歴 (プロフィール)</div>
        <div class="tab" onclick="switchTab('games')">2. ゲームリスト</div>
        <div class="tab" onclick="switchTab('schedule')">3. スケジュール</div>
        <div class="tab" style="background:#4CAF50; color:white;" onclick="generateDataFile()">★ 保存用データ作成</div>
    </div>

    <div class="editor-container">

        <!-- ==============================================
             1. プロフィール編集
             ============================================== -->
        <div id="view-profile">
            <h3>プロフィール編集</h3>
            <div class="form-group">
                <label>名前</label>
                <input type="text" id="prof-name">
            </div>
            <div class="form-group">
                <label>自己紹介文</label>
                <textarea id="prof-bio"></textarea>
            </div>
        </div>

        <!-- ==============================================
             2. ゲームリスト編集
             ============================================== -->
        <div id="view-games" style="display:none;">
            <h3>ゲームリスト編集</h3>
            <div id="games-container"></div>
            <button class="action-btn" style="background:#666; margin-top:20px;" onclick="addGame()">＋ ゲームを追加する</button>
        </div>

        <!-- ==============================================
             3. スケジュール編集
             ============================================== -->
        <div id="view-schedule" style="display:none;">
            <h3>スケジュール編集</h3>
            <div id="schedule-container"></div>
            <button class="action-btn" style="background:#666; margin-top:20px;" onclick="addSchedule()">＋
                予定を追加する</button>
        </div>

        <!-- ==============================================
             4. データ出力 (保存)
             ============================================== -->
        <div id="view-output" style="display:none;">
            <div class="instruction-box">
                <span class="step-badge">重要</span> <b>更新手順</b><br>
                1. 下の「コードをコピーする」ボタンを押します。<br>
                2. <b><code>data.js</code></b> ファイルをメモ帳などで開きます。<br>
                3. 中身をすべて消して、貼り付け（上書き）て保存してください。<br>
                4. <code>index.html</code> を開くと更新されています。
            </div>

            <div class="output-title">
                保存用データ (data.js)
                <button class="copy-btn" onclick="copyToClipboard()">コードをコピーする</button>
            </div>
            <div id="output-box" class="output-box"></div>
        </div>

    </div>

    <!-- 既存データの読み込み -->
    <script src="data.js"></script>
    <script>
        // 作業用変数
        let currentData = {
            profile: { name: "", bio: "" },
            games: [],
            schedule: []
        };

        // ページ読み込み時に data.js の内容をフォームにセット
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof portfolioData !== 'undefined') {
                // ディープコピーで読み込み
                currentData = JSON.parse(JSON.stringify(portfolioData));
                initForms();
            } else {
                alert("data.js が見つかりませんでした。新規作成モードで開始します。");
            }
        });

        function initForms() {
            // プロフィール
            document.getElementById('prof-name').value = currentData.profile.name;
            document.getElementById('prof-bio').value = currentData.profile.bio.replace(/<br>/g, "\n");

            // ゲーム
            renderGamesList();

            // スケジュール
            renderScheduleList();
        }

        function switchTab(mode) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            // Save current inputs to memory before switching
            saveCurrentInputsToMemory();

            document.getElementById('view-profile').style.display = 'none';
            document.getElementById('view-games').style.display = 'none';
            document.getElementById('view-schedule').style.display = 'none';
            document.getElementById('view-output').style.display = 'none';

            if (mode === 'profile') {
                document.getElementById('view-profile').style.display = 'block';
                event.target.classList.add('active');
            }
            if (mode === 'games') {
                document.getElementById('view-games').style.display = 'block';
                event.target.classList.add('active');
            }
            if (mode === 'schedule') {
                document.getElementById('view-schedule').style.display = 'block';
                event.target.classList.add('active');
            }
        }

        function saveCurrentInputsToMemory() {
            // Profile
            currentData.profile.name = document.getElementById('prof-name').value;
            currentData.profile.bio = document.getElementById('prof-bio').value.replace(/\n/g, "<br>");

            // Games & Schedule are updated live via inputs, no global save needed for lists specifically
            // because input onchange events handle them.
        }

        // ================= GAMES =================
        function renderGamesList() {
            const container = document.getElementById('games-container');
            container.innerHTML = "";
            currentData.games.forEach((game, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.border = "1px solid #ddd";
                div.style.padding = "15px";
                div.style.marginBottom = "20px";
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <strong>ゲーム #${index + 1} (ID: ${game.id})</strong>
                        <button onclick="removeGame(${index})" style="background:#d32f2f; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">削除</button>
                    </div>
                    <label>タイトル</label>
                    <input type="text" value="${escapeAttr(game.title)}" onchange="updateGame(${index}, 'title', this.value)">
                    
                    <label style="margin-top:10px;">ID (英数字推奨)</label>
                    <input type="text" value="${escapeAttr(game.id)}" onchange="updateGame(${index}, 'id', this.value)">

                    <label style="margin-top:10px;">画像ファイル名</label>
                    <input type="text" value="${escapeAttr(game.image)}" onchange="updateGame(${index}, 'image', this.value)">
                    
                    <label style="margin-top:10px;">紹介文</label>
                    <textarea onchange="updateGame(${index}, 'description', this.value)" style="height:100px;">${game.description}</textarea>
                `;
                container.appendChild(div);
            });
        }

        function addGame() {
            const newId = "game" + (new Date().getTime());
            currentData.games.push({
                id: newId,
                title: "新規ゲーム",
                image: "",
                description: "紹介文を入力"
            });
            renderGamesList();
        }

        function removeGame(index) {
            if (confirm("このゲームを削除してもよろしいですか？")) {
                currentData.games.splice(index, 1);
                renderGamesList();
            }
        }

        function updateGame(index, field, value) {
            currentData.games[index][field] = value;
        }

        // ================= SCHEDULE =================
        function renderScheduleList() {
            const container = document.getElementById('schedule-container');
            container.innerHTML = "";
            currentData.schedule.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.borderBottom = "1px solid #eee";
                div.style.paddingBottom = "15px";
                div.innerHTML = `
                    <div style="display:flex; gap:10px;">
                        <input type="text" placeholder="日付" value="${escapeAttr(item.date)}" style="width:150px;" onchange="updateSchedule(${index}, 'date', this.value)">
                        <input type="text" placeholder="イベント内容" value="${escapeAttr(item.event)}" style="flex:1;" onchange="updateSchedule(${index}, 'event', this.value)">
                        <button onclick="removeSchedule(${index})" style="background:#ccc; border:none; width:40px; cursor:pointer;">×</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function addSchedule() {
            currentData.schedule.push({ date: "", event: "" });
            renderScheduleList();
        }

        function removeSchedule(index) {
            currentData.schedule.splice(index, 1);
            renderScheduleList();
        }

        function updateSchedule(index, field, value) {
            currentData.schedule[index][field] = value;
        }


        // ================= GENERATE =================
        function generateDataFile() {
            saveCurrentInputsToMemory();

            const jsonStr = JSON.stringify(currentData, null, 4);
            // JSファイル形式にする
            const fileContent = `/* ============================================================
   ホームページのデータファイル
   ============================================================ */

const portfolioData = ${jsonStr};
`;

            document.getElementById('view-profile').style.display = 'none';
            document.getElementById('view-games').style.display = 'none';
            document.getElementById('view-schedule').style.display = 'none';
            document.getElementById('view-output').style.display = 'block'; // Show output

            document.getElementById('output-box').innerText = fileContent;

            // Scroll to output
            document.getElementById('view-output').scrollIntoView();
        }

        function escapeAttr(text) {
            if (!text) return "";
            return text.replace(/"/g, "&quot;");
        }

        function copyToClipboard() {
            const text = document.getElementById('output-box').innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('コピーしました！ data.js に上書き保存してください。');
            });
        }
    </script>
</body>

</html>
```